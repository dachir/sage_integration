[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Item",
  "enabled": 1,
  "modified": "2023-04-10 10:39:29.667256",
  "module": null,
  "name": "Famille Statistique Filters",
  "script": "frappe.ui.form.on('Item', {\n\tsetup(frm) {\n\t\tfrm.set_query(\"category\", function() {\n\t\t\treturn {\n\t\t\t\t\"filters\": {\n\t\t\t\t\t\"level\": 20\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\t\tfrm.set_query(\"sub_category\", function() {\n\t\t\treturn {\n\t\t\t\t\"filters\": {\n\t\t\t\t\t\"level\": 21\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\t}\n\t\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Material Request",
  "enabled": 1,
  "modified": "2023-06-21 15:51:44.353780",
  "module": null,
  "name": "Material Issue Location Filter",
  "script": "frappe.ui.form.on('Material Request', {\n\trefresh(frm) {\n\t\t// your code here\n\t\tif (frm.is_new()) frm.set_value('ws_code', 'ZSMO_' + frm.doc.issue_type.substring(0, 3))\n\t\tfrm.add_custom_button('Warehouse Stock',() =>{\n            new frappe.ui.form.MultiSelectDialog({\n                doctype: \"Bin\",\n                target: cur_frm,\n                setters: {\n                    warehouse: \"\",\n\t\t\t\t\titem_code: \"\",\n\t\t\t\t\titem_name: \"\",\n\t\t\t\t\tactual_qty: \"\",\n                },\n                add_filters_group: 1,\n                columns: [\"name\", \"warehouse\", \"item_code\",\"item_name\", \"actual_qty\"],\n                get_query() {\n                    return {\n                        filters: null\n                    }\n                },\n                action(selections, args) {\n                    console.log(\"params\");\n                    selections.forEach(e => {\n\t\t\t\t\t\tvar row = cur_frm.add_child('items');\n\t\t\t\t\t\tfrappe.db.get_doc(\"Bin\",e).then(b =>{\n\t\t\t\t\t\t    frappe.db.get_doc(\"Item\",b.item_code).then(i => {\n\t\t\t\t\t\t        row.item_code = b.item_code;\n        \t\t\t\t\t\trow.warehouse = b.warehouse;\n        \t\t\t\t\t\trow.qty = b.actual_qty;\n        \t\t\t\t\t\trow.description = i.item_name;\n        \t\t\t\t\t\trow.uom = b.stock_uom;\n        \t\t\t\t\t\trow.branch = cur_frm.doc.branch;\n    \t\t                    row.cost_center = cur_frm.doc.cost_center;\n        \t\t\t\t\t\t//console.log(b);\n        \t\t\t\t\t\tfrm.events.get_item_data(frm, row, false);\n        \t\t\t\t\t\tif(cur_frm.doc.schedule_date) {\n                        \t\t\trow.schedule_date = cur_frm.doc.schedule_date;\n                        \t\t\tcur_frm.refresh_field('schedule_date');\n                        \t\t} else {\n                        \t\t\tcur_frm.script_manager.copy_from_first_row(\"items\", row, [\"schedule_date\"]);\n                        \t\t}\n        \t\t\t\t\t\tcur_frm.dirty();\n    \t\t\t\t\t        cur_frm.refresh_field('items');\n\t\t\t\t\t\t    });\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\t\n                },\n                //allow_child_item_selection: true,\n                //child_fieldname: \"availability_details\",\n                //child_columns: [\"description\",\"day\",\"start_time\",\"end_time\"] // retorune name dans args.filtered_children   \n            });\n        },);\n\t},\n\tissue_type(frm) {\n\t    frm.set_value('ws_code', 'ZSMO_' + frm.doc.issue_type.substring(0, 3))\n\t},\n});\n\nfrappe.ui.form.on('Material Request Item', {\n    items_add(frm, cdt, cdn) {\n\t\tvar row = locals[cdt][cdn];\n\t\trow.branch = frm.doc.branch;\n\t\trow.cost_center = frm.doc.cost_center;\n\t\tfrm.refresh_field(\"items\");\n\t}\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Material Request",
  "enabled": 0,
  "modified": "2023-05-11 11:15:36.773506",
  "module": null,
  "name": "Material Issue To Stock Entry",
  "script": "frappe.ui.form.on('Material Request', {\n\trefresh(frm) {\n\t\tif (frm.doc.material_request_type === \"Material Issue\") {\n\t\t\t\t\tfrm.add_custom_button(__(\"Issue Material\"),\n\t\t\t\t\t\t() => frm.events.make_stock_entry(frm), __('Create'));\n\t\t\t\t}\n\t},\n\tmake_stock_entry: function(frm) {\n\t\tfrappe.model.open_mapped_doc({\n\t\t\tmethod: \"sage_integration.overrides.materiel_request.make_stock_entry2\",\n\t\t\tfrm: frm\n\t\t});\n\t},\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Loan Type",
  "enabled": 1,
  "modified": "2023-05-10 15:10:11.201370",
  "module": null,
  "name": "Loan Type Filter Override",
  "script": "frappe.ui.form.on('Loan Type', {\r\n\tonload: function(frm) {\r\n\t\t$.each([\"penalty_income_account\", \"interest_income_account\"], function (i, field) {\r\n\t\t\tfrm.set_query(field, function () {\r\n\t\t\t\treturn {\r\n\t\t\t\t\t\"filters\": {\r\n\t\t\t\t\t\t\"company\": frm.doc.company,\r\n\t\t\t\t\t\t\"root_type\": \"Income\",\r\n\t\t\t\t\t\t\"is_group\": 0\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$.each([\"payment_account\", \"loan_account\", \"disbursement_account\"], function (i, field) {\r\n\t\t\tfrm.set_query(field, function () {\r\n\t\t\t\treturn {\r\n\t\t\t\t\t\"filters\": [\r\n                        [\"company\", \"=\", frm.doc.company],\r\n                        [\"root_type\", \"IN\", [\"Asset\", \"Liability\"]],\r\n                        [\"is_group\", \"=\", 0]\r\n                    ]\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n});\r\n\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Employee",
  "enabled": 1,
  "modified": "2022-10-13 11:49:18.221149",
  "module": null,
  "name": "Get Employee Category Details",
  "script": "frappe.ui.form.on('Employee', {\n\temployee_category_details(frm) {\n\t\t// your code here\n\t\tfrappe.db.get_doc(\"Employee Category Details\", frm.doc.employee_category_details).then(r => {\n\t\t    //alert(r.conge_days);\n\t\t    frm.doc.conge_days = r.conge_days;\n\t\t    //frm.doc.conge_days_5_years = r.conge_days_5_years;\n    \t\tfrm.doc.basic_salary_per_day = r.basic_salary_per_day;\n    \t\tfrm.doc.basic_salary_per_hour = r.basic_salary_per_hour;\n    \t\tfrm.doc.logement = r.logement;\n    \t\tfrm.doc.transport = r.transport;\n    \t\tfrm.doc.conge_days_final_settlement = r.conge_days_final_settlement;\n    \t\tfrm.doc.conge_year_final_settlement = r.conge_year_final_settlement;\n    \t\tfrm.dirty();\n\t\t    frm.refresh();\n\t\t});\n\t}\n\t\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Attendance list",
  "enabled": 0,
  "modified": "2022-10-14 10:20:04.930843",
  "module": null,
  "name": "Attendance list-Form",
  "script": "frappe.ui.form.on('Attendance list', {\n\trefresh(frm) {\n\t\t// your code here\n\t}\n})\n\nfrappe.ui.form.on('Attendace Details', {\n    form_render: function(frm,cdt,cdn) {\n       let item = locals[cdt][cdn]; \n       let pay_period = `Payroll Period`.pay_period;\n       item.pay_period = pay_period;\n       frm.refresh_field('Attendace Details');\n    },\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Payroll Entry",
  "enabled": 0,
  "modified": "2022-10-19 12:28:03.690732",
  "module": null,
  "name": "Override Payroll Entry",
  "script": "// Copyright (c) 2017, Frappe Technologies Pvt. Ltd. and contributors\r\n// For license information, please see license.txt\r\n\r\nvar in_progress = false;\r\n\r\nfrappe.provide(\"erpnext.accounts.dimensions\");\r\n\r\nfrappe.ui.form.on('Payroll Entry', {\r\n\tonload: function (frm) {\r\n\t\tif (!frm.doc.posting_date) {\r\n\t\t\tfrm.doc.posting_date = frappe.datetime.nowdate();\r\n\t\t}\r\n\t\tfrm.toggle_reqd(['payroll_frequency'], !frm.doc.salary_slip_based_on_timesheet);\r\n\r\n\t\terpnext.accounts.dimensions.setup_dimension_filters(frm, frm.doctype);\r\n\t\tfrm.events.department_filters(frm);\r\n\t\tfrm.events.payroll_payable_account_filters(frm);\r\n\t},\r\n\r\n\tdepartment_filters: function (frm) {\r\n\t\tfrm.set_query(\"department\", function () {\r\n\t\t\treturn {\r\n\t\t\t\t\"filters\": {\r\n\t\t\t\t\t\"company\": frm.doc.company,\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t});\r\n\t},\r\n\r\n\tpayroll_payable_account_filters: function (frm) {\r\n\t\tfrm.set_query(\"payroll_payable_account\", function () {\r\n\t\t\treturn {\r\n\t\t\t\tfilters: {\r\n\t\t\t\t\t\"company\": frm.doc.company,\r\n\t\t\t\t\t\"root_type\": \"Liability\",\r\n\t\t\t\t\t\"is_group\": 0,\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t});\r\n\t},\r\n\r\n\trefresh: function (frm) {\r\n\t\tif (frm.doc.docstatus === 0 && !frm.is_new()) {\r\n\t\t\tfrm.page.clear_primary_action();\r\n\t\t\tfrm.add_custom_button(__(\"Get Employees 2\"),\r\n\t\t\t\tfunction () {\r\n\t\t\t\t\tfrm.events.get_employee_details(frm);\r\n\t\t\t\t}\r\n\t\t\t).toggleClass(\"btn-primary\", !(frm.doc.employees || []).length);\r\n\t\t}\r\n\r\n\t\tif (\r\n\t\t\t(frm.doc.employees || []).length\r\n\t\t\t&& !frappe.model.has_workflow(frm.doctype)\r\n\t\t\t&& !cint(frm.doc.salary_slips_created)\r\n\t\t\t&& (frm.doc.docstatus != 2)\r\n\t\t) {\r\n\t\t\tif (frm.doc.docstatus === 0) {\r\n\t\t\t\tfrm.page.clear_primary_action();\r\n\t\t\t\tfrm.page.set_primary_action(__(\"Create Salary Slips\"), () => {\r\n\t\t\t\t\tfrm.save(\"Submit\").then(() => {\r\n\t\t\t\t\t\tfrm.page.clear_primary_action();\r\n\t\t\t\t\t\tfrm.refresh();\r\n\t\t\t\t\t\tfrm.events.refresh(frm);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t} else if (frm.doc.docstatus == 1 && frm.doc.status == \"Failed\") {\r\n\t\t\t\tfrm.add_custom_button(__(\"Create Salary Slip\"), function () {\r\n\t\t\t\t\tfrm.call(\"create_salary_slips\", {}, () => {\r\n\t\t\t\t\t\tfrm.reload_doc();\r\n\t\t\t\t\t});\r\n\t\t\t\t}).addClass(\"btn-primary\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (frm.doc.docstatus == 1 && frm.doc.status == \"Submitted\") {\r\n\t\t\tif (frm.custom_buttons) frm.clear_custom_buttons();\r\n\t\t\tfrm.events.add_context_buttons(frm);\r\n\t\t}\r\n\r\n\t\tif (frm.doc.status == \"Failed\" && frm.doc.error_message) {\r\n\t\t\tconst issue = `<a id=\"jump_to_error\" style=\"text-decoration: underline;\">issue</a>`;\r\n\t\t\tlet process = (cint(frm.doc.salary_slips_created)) ? \"submission\" : \"creation\";\r\n\r\n\t\t\tfrm.dashboard.set_headline(\r\n\t\t\t\t__(\"Salary Slip {0} failed. You can resolve the {1} and retry {0}.\", [process, issue])\r\n\t\t\t);\r\n\r\n\t\t\t$(\"#jump_to_error\").on(\"click\", (e) => {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tfrappe.utils.scroll_to(\r\n\t\t\t\t\tfrm.get_field(\"error_message\").$wrapper,\r\n\t\t\t\t\ttrue,\r\n\t\t\t\t\t30\r\n\t\t\t\t);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfrappe.realtime.on(\"completed_salary_slip_creation\", function() {\r\n\t\t\tfrm.reload_doc();\r\n\t\t});\r\n\r\n\t\tfrappe.realtime.on(\"completed_salary_slip_submission\", function() {\r\n\t\t\tfrm.reload_doc();\r\n\t\t});\r\n\t},\r\n\r\n\tget_employee_details: function (frm) {\r\n\t\treturn frappe.call({\r\n\t\t\tdoc: frm.doc,\r\n\t\t\tmethod: 'fill_employee_details',\r\n\t\t}).then(r => {\r\n\t\t\tif (r.docs && r.docs[0].employees) {\r\n\t\t\t\tfrm.employees = r.docs[0].employees;\r\n\t\t\t\tfrm.dirty();\r\n\t\t\t\tfrm.save();\r\n\t\t\t\tfrm.refresh();\r\n\t\t\t\tif (r.docs[0].validate_attendance) {\r\n\t\t\t\t\trender_employee_attendance(frm, r.message);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tcreate_salary_slips: function (frm) {\r\n\t\tfrm.call({\r\n\t\t\tdoc: frm.doc,\r\n\t\t\tmethod: \"create_salary_slips\",\r\n\t\t\tcallback: function () {\r\n\t\t\t\tfrm.reload_doc();\r\n\t\t\t\tfrm.toolbar.refresh();\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tadd_context_buttons: function (frm) {\r\n\t\tif (frm.doc.salary_slips_submitted || (frm.doc.__onload && frm.doc.__onload.submitted_ss)) {\r\n\t\t\tfrm.events.add_bank_entry_button(frm);\r\n\t\t} else if (frm.doc.salary_slips_created && frm.doc.status != 'Queued') {\r\n\t\t\tfrm.add_custom_button(__(\"Submit Salary Slip\"), function () {\r\n\t\t\t\tsubmit_salary_slip(frm);\r\n\t\t\t}).addClass(\"btn-primary\");\r\n\t\t}\r\n\t},\r\n\r\n\tadd_bank_entry_button: function (frm) {\r\n\t\tfrappe.call({\r\n\t\t\tmethod: 'hrms.payroll.doctype.payroll_entry.payroll_entry.payroll_entry_has_bank_entries',\r\n\t\t\targs: {\r\n\t\t\t\t'name': frm.doc.name\r\n\t\t\t},\r\n\t\t\tcallback: function (r) {\r\n\t\t\t\tif (r.message && !r.message.submitted) {\r\n\t\t\t\t\tfrm.add_custom_button(__(\"Make Bank Entry\"), function () {\r\n\t\t\t\t\t\tmake_bank_entry(frm);\r\n\t\t\t\t\t}).addClass(\"btn-primary\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tsetup: function (frm) {\r\n\t\tfrm.add_fetch('company', 'cost_center', 'cost_center');\r\n\r\n\t\tfrm.set_query(\"payment_account\", function () {\r\n\t\t\tvar account_types = [\"Bank\", \"Cash\"];\r\n\t\t\treturn {\r\n\t\t\t\tfilters: {\r\n\t\t\t\t\t\"account_type\": [\"in\", account_types],\r\n\t\t\t\t\t\"is_group\": 0,\r\n\t\t\t\t\t\"company\": frm.doc.company\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t});\r\n\r\n\t\tfrm.set_query('employee', 'employees', () => {\r\n\t\t\tlet error_fields = [];\r\n\t\t\tlet mandatory_fields = ['company', 'payroll_frequency', 'start_date', 'end_date'];\r\n\r\n\t\t\tlet message = __('Mandatory fields required in {0}', [__(frm.doc.doctype)]);\r\n\r\n\t\t\tmandatory_fields.forEach(field => {\r\n\t\t\t\tif (!frm.doc[field]) {\r\n\t\t\t\t\terror_fields.push(frappe.unscrub(field));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif (error_fields && error_fields.length) {\r\n\t\t\t\tmessage = message + '<br><br><ul><li>' + error_fields.join('</li><li>') + \"</ul>\";\r\n\t\t\t\tfrappe.throw({\r\n\t\t\t\t\tmessage: message,\r\n\t\t\t\t\tindicator: 'red',\r\n\t\t\t\t\ttitle: __('Missing Fields')\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\tquery: \"hrms.payroll.doctype.payroll_entry.payroll_entry.employee_query\",\r\n\t\t\t\tfilters: frm.events.get_employee_filters(frm)\r\n\t\t\t};\r\n\t\t});\r\n\t},\r\n\r\n\tget_employee_filters: function (frm) {\r\n\t\tlet filters = {};\r\n\t\tfilters['salary_slip_based_on_timesheet'] = frm.doc.salary_slip_based_on_timesheet;\r\n\r\n\t\tlet fields = ['company', 'start_date', 'end_date', 'payroll_frequency', 'payroll_payable_account',\r\n\t\t\t'currency', 'department', 'branch', 'designation', 'eventual'];\r\n\r\n\t\tfields.forEach(field => {\r\n\t\t\tif (frm.doc[field]) {\r\n\t\t\t\tfilters[field] = frm.doc[field];\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif (frm.doc.employees) {\r\n\t\t\tlet employees = frm.doc.employees.filter(d => d.employee).map(d => d.employee);\r\n\t\t\tif (employees && employees.length) {\r\n\t\t\t\tfilters['employees'] = employees;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn filters;\r\n\t},\r\n\r\n\tpayroll_frequency: function (frm) {\r\n\t\tfrm.trigger(\"set_start_end_dates\").then( ()=> {\r\n\t\t\tfrm.events.clear_employee_table(frm);\r\n\t\t});\r\n\t},\r\n\r\n\tcompany: function (frm) {\r\n\t\tfrm.events.clear_employee_table(frm);\r\n\t\terpnext.accounts.dimensions.update_dimension(frm, frm.doctype);\r\n\t\tfrm.trigger(\"set_payable_account_and_currency\");\r\n\t},\r\n\r\n\tset_payable_account_and_currency: function (frm) {\r\n\t\tfrappe.db.get_value(\"Company\", {\"name\": frm.doc.company}, \"default_currency\", (r) => {\r\n\t\t\tfrm.set_value('currency', r.default_currency);\r\n\t\t});\r\n\t\tfrappe.db.get_value(\"Company\", {\"name\": frm.doc.company}, \"default_payroll_payable_account\", (r) => {\r\n\t\t\tfrm.set_value('payroll_payable_account', r.default_payroll_payable_account);\r\n\t\t});\r\n\t},\r\n\r\n\tcurrency: function (frm) {\r\n\t\tvar company_currency;\r\n\t\tif (!frm.doc.company) {\r\n\t\t\tcompany_currency = erpnext.get_currency(frappe.defaults.get_default(\"Company\"));\r\n\t\t} else {\r\n\t\t\tcompany_currency = erpnext.get_currency(frm.doc.company);\r\n\t\t}\r\n\t\tif (frm.doc.currency) {\r\n\t\t\tif (company_currency != frm.doc.currency) {\r\n\t\t\t\tfrappe.call({\r\n\t\t\t\t\tmethod: \"erpnext.setup.utils.get_exchange_rate\",\r\n\t\t\t\t\targs: {\r\n\t\t\t\t\t\tfrom_currency: frm.doc.currency,\r\n\t\t\t\t\t\tto_currency: company_currency,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcallback: function (r) {\r\n\t\t\t\t\t\tfrm.set_value(\"exchange_rate\", flt(r.message));\r\n\t\t\t\t\t\tfrm.set_df_property('exchange_rate', 'hidden', 0);\r\n\t\t\t\t\t\tfrm.set_df_property(\"exchange_rate\", \"description\", \"1 \" + frm.doc.currency +\r\n\t\t\t\t\t\t\t\" = [?] \" + company_currency);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tfrm.set_value(\"exchange_rate\", 1.0);\r\n\t\t\t\tfrm.set_df_property('exchange_rate', 'hidden', 1);\r\n\t\t\t\tfrm.set_df_property(\"exchange_rate\", \"description\", \"\");\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tdepartment: function (frm) {\r\n\t\tfrm.events.clear_employee_table(frm);\r\n\t},\r\n\r\n\tdesignation: function (frm) {\r\n\t\tfrm.events.clear_employee_table(frm);\r\n\t},\r\n\r\n\tbranch: function (frm) {\r\n\t\tfrm.events.clear_employee_table(frm);\r\n\t},\r\n\r\n\tstart_date: function (frm) {\r\n\t\tif (!in_progress && frm.doc.start_date) {\r\n\t\t\tfrm.trigger(\"set_end_date\");\r\n\t\t} else {\r\n\t\t\t// reset flag\r\n\t\t\tin_progress = false;\r\n\t\t}\r\n\t\tfrm.events.clear_employee_table(frm);\r\n\t},\r\n\r\n\tproject: function (frm) {\r\n\t\tfrm.events.clear_employee_table(frm);\r\n\t},\r\n\r\n\tsalary_slip_based_on_timesheet: function (frm) {\r\n\t\tfrm.toggle_reqd(['payroll_frequency'], !frm.doc.salary_slip_based_on_timesheet);\r\n\t},\r\n\r\n\tset_start_end_dates: function (frm) {\r\n\t\tif (!frm.doc.salary_slip_based_on_timesheet) {\r\n\t\t\tfrappe.call({\r\n\t\t\t\tmethod: 'hrms.payroll.doctype.payroll_entry.payroll_entry.get_start_end_dates',\r\n\t\t\t\targs: {\r\n\t\t\t\t\tpayroll_frequency: frm.doc.payroll_frequency,\r\n\t\t\t\t\tstart_date: frm.doc.posting_date\r\n\t\t\t\t},\r\n\t\t\t\tcallback: function (r) {\r\n\t\t\t\t\tif (r.message) {\r\n\t\t\t\t\t\tin_progress = true;\r\n\t\t\t\t\t\tfrm.set_value('start_date', r.message.start_date);\r\n\t\t\t\t\t\tfrm.set_value('end_date', r.message.end_date);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\tset_end_date: function (frm) {\r\n\t\tfrappe.call({\r\n\t\t\tmethod: 'hrms.payroll.doctype.payroll_entry.payroll_entry.get_end_date',\r\n\t\t\targs: {\r\n\t\t\t\tfrequency: frm.doc.payroll_frequency,\r\n\t\t\t\tstart_date: frm.doc.start_date\r\n\t\t\t},\r\n\t\t\tcallback: function (r) {\r\n\t\t\t\tif (r.message) {\r\n\t\t\t\t\tfrm.set_value('end_date', r.message.end_date);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tvalidate_attendance: function (frm) {\r\n\t\tif (frm.doc.validate_attendance && frm.doc.employees) {\r\n\t\t\tfrappe.call({\r\n\t\t\t\tmethod: 'validate_employee_attendance',\r\n\t\t\t\targs: {},\r\n\t\t\t\tcallback: function (r) {\r\n\t\t\t\t\trender_employee_attendance(frm, r.message);\r\n\t\t\t\t},\r\n\t\t\t\tdoc: frm.doc,\r\n\t\t\t\tfreeze: true,\r\n\t\t\t\tfreeze_message: __('Validating Employee Attendance...')\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tfrm.fields_dict.attendance_detail_html.html(\"\");\r\n\t\t}\r\n\t},\r\n\r\n\tclear_employee_table: function (frm) {\r\n\t\tfrm.clear_table('employees');\r\n\t\tfrm.refresh();\r\n\t},\r\n});\r\n\r\n// Submit salary slips\r\n\r\nconst submit_salary_slip = function (frm) {\r\n\tfrappe.confirm(__('This will submit Salary Slips and create accrual Journal Entry. Do you want to proceed?'),\r\n\t\tfunction () {\r\n\t\t\tfrappe.call({\r\n\t\t\t\tmethod: 'submit_salary_slips',\r\n\t\t\t\targs: {},\r\n\t\t\t\tcallback: function () {\r\n\t\t\t\t\tfrm.reload_doc();\r\n\t\t\t\t\tfrm.events.refresh(frm);\r\n\t\t\t\t},\r\n\t\t\t\tdoc: frm.doc,\r\n\t\t\t\tfreeze: true,\r\n\t\t\t\tfreeze_message: __('Submitting Salary Slips and creating Journal Entry...')\r\n\t\t\t});\r\n\t\t},\r\n\t\tfunction () {\r\n\t\t\tif (frappe.dom.freeze_count) {\r\n\t\t\t\tfrappe.dom.unfreeze();\r\n\t\t\t\tfrm.events.refresh(frm);\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n};\r\n\r\nlet make_bank_entry = function (frm) {\r\n\tvar doc = frm.doc;\r\n\tif (doc.payment_account) {\r\n\t\treturn frappe.call({\r\n\t\t\tdoc: cur_frm.doc,\r\n\t\t\tmethod: \"make_payment_entry\",\r\n\t\t\tcallback: function () {\r\n\t\t\t\tfrappe.set_route(\r\n\t\t\t\t\t'List', 'Journal Entry', {\r\n\t\t\t\t\t\t\"Journal Entry Account.reference_name\": frm.doc.name\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t},\r\n\t\t\tfreeze: true,\r\n\t\t\tfreeze_message: __(\"Creating Payment Entries......\")\r\n\t\t});\r\n\t} else {\r\n\t\tfrappe.msgprint(__(\"Payment Account is mandatory\"));\r\n\t\tfrm.scroll_to_field('payment_account');\r\n\t}\r\n};\r\n\r\nlet render_employee_attendance = function (frm, data) {\r\n\tfrm.fields_dict.attendance_detail_html.html(\r\n\t\tfrappe.render_template('employees_to_mark_attendance', {\r\n\t\t\tdata: data\r\n\t\t})\r\n\t);\r\n};",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Salary Slip",
  "enabled": 1,
  "modified": "2022-10-17 11:30:24.742193",
  "module": null,
  "name": "Salary Slip Update Structure",
  "script": "frappe.ui.form.on('Salary Slip', {\n\tsalary_type(frm) {\n\t\t// your code here\n\t\tfrappe.db.get_value(\"Salary Structure\", {\"salary_type\": frm.doc.salary_type, \"docstatus\": 1}, \"name\", (r) => {\n\t\t\tfrm.set_value('salary_structure', r.name);\n\t\t\tfrm.events.get_emp_and_working_day_details(frm);\n\t\t});\n\t\t//frm.doc.salary_structure \n\t},\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Employee loan Application",
  "enabled": 0,
  "modified": "2022-10-19 14:54:08.973168",
  "module": null,
  "name": "Employee loan Application",
  "script": "frappe.ui.form.on('Employee loan Application', {\n\trefresh(frm) {\n\t\tif (frm.doc.docstatus === 0 && !frm.is_new()) {\n\t\t\tfrm.page.clear_primary_action();\n\t\t\tfrm.add_custom_button(__(\"Get Employees\"),\n\t\t\t\tfunction () {\n\t\t\t\t\t//frm.events.get_employee_details(frm);\n\t\t\t\t}\n\t\t\t).toggleClass(\"btn-primary\", !(frm.doc.employee_details || []).length);\n\t\t}\n\t},\n\t\n\tnumber_of_installments(frm) {\n\t    frm.set_value('installment_amount', 0);\n\t    if(frm.doc.number_of_installments){\n    \t\tif(frm.doc.loan_amount){\n    \t\t    var installment_amount = 0;\n    \t\t    if (frm.doc.number_of_installments > 0) installment_amount = frm.doc.loan_amount / frm.doc.number_of_installments;\n    \t\t    frm.set_value('installment_amount', installment_amount);\n    \t\t}\n\t    }\n\t},\n\t\n\tloan_amount(frm) {\n\t    frm.set_value('installment_amount', 0);\n\t    if(frm.doc.loan_amount){\n    \t\tif(frm.doc.number_of_installments){\n    \t\t    var installment_amount = 0;\n    \t\t    if (frm.doc.number_of_installments > 0) installment_amount = frm.doc.loan_amount / frm.doc.number_of_installments;\n    \t\t    frm.set_value('installment_amount', installment_amount);\n    \t\t}\n\t    }\n\t},\n\t\n\tcurrency: function (frm) {\n\t\tvar company_currency;\n\t\tif (!frm.doc.company) {\n\t\t\tcompany_currency = erpnext.get_currency(frappe.defaults.get_default(\"Company\"));\n\t\t} else {\n\t\t\tcompany_currency = erpnext.get_currency(frm.doc.company);\n\t\t}\n\t\tif (frm.doc.currency) {\n\t\t\tif (company_currency != frm.doc.currency) {\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"erpnext.setup.utils.get_exchange_rate\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tfrom_currency: frm.doc.currency,\n\t\t\t\t\t\tto_currency: company_currency,\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\tfrm.set_value(\"exchange_rate\", flt(r.message));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tfrm.set_value(\"exchange_rate\", 1.0);\n\t\t\t}\n\t\t}\n\t},\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Loan",
  "enabled": 1,
  "modified": "2023-02-13 10:26:05.972533",
  "module": null,
  "name": "Get Currency for Loan",
  "script": "frappe.ui.form.on('Loan', {\n\tcurrency: function (frm) {\n\t\tvar company_currency;\n\t\tif (!frm.doc.company) {\n\t\t\tcompany_currency = erpnext.get_currency(frappe.defaults.get_default(\"Company\"));\n\t\t} else {\n\t\t\tcompany_currency = erpnext.get_currency(frm.doc.company);\n\t\t}\n\t\tif (frm.doc.currency) {\n\t\t\tif (company_currency != frm.doc.currency) {\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"erpnext.setup.utils.get_exchange_rate\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tfrom_currency: frm.doc.currency,\n\t\t\t\t\t\tto_currency: company_currency,\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\tfrm.set_value(\"exchange_rate\", flt(r.message));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tfrm.set_value(\"exchange_rate\", 1.0);\n\t\t\t}\n\t\t}\n\t},\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Employee",
  "enabled": 1,
  "modified": "2022-12-30 15:37:22.947948",
  "module": null,
  "name": "Employee Depedant Management",
  "script": "frappe.ui.form.on('Employee', {\n    refresh: function(frm) {\n        if(frm.doc.dependant.length <= 0) frm.get_field('dependant').grid.cannot_add_rows = true;\n        else frm.get_field('dependant').grid.cannot_add_rows = false;\n        \n        if(frm.doc.dependant.length > 0){\n\t \t    frm.get_field('dependant').grid.grid_rows[0].docfields[0].read_only = 1;\n\t \t    frm.get_field('dependant').grid.grid_rows[0].docfields[1].read_only = 1;\n\t \t    frm.get_field('dependant').grid.grid_rows[0].docfields[2].read_only = 1;\n\t \t}\n        \n        frm.refresh_field('dependant');\n    },\n\tafter_save(frm) {\n\t\tif(frm.doc.dependant.length <= 0) frm.events.get_employee_dependant(frm);\n\t},\n\tget_employee_dependant: function (frm) {\n\t\treturn frappe.call({\n\t\t\tmethod: 'paie.override.employee.get_employee_dependant',\n\t\t\targs: { \"emp_name\": frm.doc.name, },\n\t\t    callback: function(r, rt){\n    \t\t\tif (r.message) {\n    \t\t\t    var row = frm.add_child('dependant');\n    \t\t\t\trow.code = r.message.employee,\n\t\t\t\t    row.type = 'Employee',\n\t\t\t\t    row.nom_complet = r.message.employee_name;\n\t\t\t\t    row.date_naissance = r.message.date_of_birth;\n    \t\t\t\tfrm.refresh_field('dependant');\n    \t\t\t\tfrm.dirty();\n    \t\t\t\t//frm.save();\n    \t\t\t\tfrm.refresh();\n    \t\t\t}\n\t\t    }\n\t\t});\n\t},\n});\n\nfrappe.ui.form.on('Dependant', {\n\tbefore_dependant_remove: function(frm, cdt, cdn) {\n\t \tvar row = locals[cdt][cdn];\n\t \tif(row.idx != 1) return;\n\t \tfrappe.throw(__(\"Employee cannot be removed\"));\n\t},\n\ttype: function(frm, cdt, cdn) {\n\t \tvar row = locals[cdt][cdn];\n\t \t\tif(row.idx != 1 && row.type == \"Employee\") {\n\t \t\t    frappe.throw(__(\"Cannot select 'Employee'!!!\"));\n\t \t\t    \n\t \t\t}\n\t},\n});\n\n\n\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Leave Application",
  "enabled": 1,
  "modified": "2023-02-16 09:48:22.869299",
  "module": null,
  "name": "Leave Type Filter",
  "script": "frappe.ui.form.on('Leave Application', {\n\temployee: function(frm) {\n\t\tfrm.trigger(\"make_dashboard2\");\n\t},\n\tfrom_date: function(frm) {\n\t\tfrm.trigger(\"make_dashboard2\");\n\t},\n\tto_date: function(frm) {\n\t\tfrm.trigger(\"make_dashboard2\");\n\t},\n\t\n\tmake_dashboard2: function(frm) {\n\t\tvar leave_details;\n\t\tlet all_leaves;\n\t\tif (frm.doc.employee) {\n\t\t\tfrm.set_query('leave_type', function() {\n\t\t\t\treturn {\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\t['leave_type_name', '!=', 'zzz']\n\t\t\t\t\t]\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\t},\n})",
  "view": "Form"
 }
]